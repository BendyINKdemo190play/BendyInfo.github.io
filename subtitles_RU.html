<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Генератор команды tellraw для Minecraft 1.21.1</title>
    <link rel="stylesheet" href="style.css"> <!-- Подключение стилей -->
</head>
<body>

<h1>Генератор команды tellraw для Minecraft 1.21.1</h1>

<div id="textInputsContainer" style="text-align: center;">
    <div class="text-input">
        <input type="text" class="userText" placeholder="Введите текст сообщения..." style="border-radius: 15px;">
        <button onclick="toggleColorPicker(this)">Цвет</button>
        <input type="color" class="colorPicker" value="#ff0000" onchange="updateColor(this)">
        <input type="text" class="optionalLink" placeholder="Введите ссылку (необязательно)" style="width: 300px; margin-top: 10px; border-radius: 15px;">
        <button onclick="addNewLineWithNewline()">\\n</button>
    </div>
</div>

<div style="text-align: center; margin-top: 20px;">
    <label for="targetSelect">Кому отправить сообщение:</label>
    <select id="targetSelect" style="display: block; margin: 0 auto;">
        <option value="@a">Всем игрокам (@a)</option>
        <option value="@p">Ближайшему игроку (@p)</option>
        <option value="@s">Себе (@s)</option>
    </select>
    <br>
    <label for="customTarget">Или введите имя игрока:</label>
    <input type="text" id="customTarget" placeholder="Имя игрока..." style="width: 300px; margin-top: 10px; border-radius: 15px;">
</div>

<div style="text-align: center; margin-top: 20px;">
    <button onclick="addNewLine()">Добавить новую строку</button>
    <button onclick="generateCommand()">Сгенерировать команду</button>
</div>

<div style="text-align: center; margin-top: 20px;">
    <button onclick="formatText('bold')">Жирный</button>
    <button onclick="formatText('italic')">Курсив</button>
    <button onclick="formatText('underline')">Подчеркнутый</button>
    <button onclick="formatText('strikethrough')">Зачеркнутый</button>
    <button onclick="formatText('obfuscated')">Моноширинный</button>
</div>

<h2 style="text-align: center;">Сгенерированная команда:</h2>
<pre id="output" style="text-align: center;"></pre>

<div style="text-align: center; margin-top: 40px;">
    <p style="font-size: 18px;">Создатель: Perplexity и создатель карты "Перекрестие"</p>
</div>

<div style="text-align: center; margin-top: 20px;">
    <a href="index.html"><button>Перейти на английскую версию</button></a>
	<a href="vilagers_RU.html"><button>Перейти на Генератор кастомных жителей для Minecraft</button></a>
</div>

<script>
// Переключение видимости выбора цвета
function toggleColorPicker(button) {
    const colorPicker = button.nextElementSibling;
    colorPicker.click();
}

function updateColor(colorInput) {
    const userText = colorInput.parentElement.querySelector('.userText');
    userText.style.color = colorInput.value;
}

function formatText(style) {
    const userText = document.querySelector('.userText');

    switch (style) {
        case 'bold':
            userText.value = `§l${userText.value}§r`;
            break;
        case 'italic':
            userText.value = `§o${userText.value}§r`;
            break;
        case 'underline':
            userText.value = `§n${userText.value}§r`;
            break;
        case 'strikethrough':
            userText.value = `§m${userText.value}§r`;
            break;
        case 'obfuscated':
            userText.value = `§k${userText.value}§r`;
            break;
    }
}

function addNewLine() {
    const container = document.getElementById('textInputsContainer');
    const newLine = document.createElement('div');
    newLine.classList.add('text-input');

    newLine.innerHTML = `
        <input type='text' class='userText' placeholder='Введите текст сообщения...' style='border-radius:15px;'>
        <button onclick='toggleColorPicker(this)'>Цвет</button>
        <input type='color' class='colorPicker' value='#ff0000' onchange='updateColor(this)'>
        <input type='text' class='optionalLink' placeholder='Введите ссылку (необязательно)' style='width:300px;margin-top:10px;border-radius:15px;'>
        <button onclick='addNewLineWithNewline()'>\\n</button><br/>
        <button onclick='removeLine(this)' style='color:red;'>✖️ Удалить строку</button>
   `;

   container.appendChild(newLine);
}

function removeLine(button) {
   const lineToRemove = button.parentElement;
   lineToRemove.remove();
}

function addNewLineWithNewline() {
   const inputs = document.querySelectorAll('.userText');
   if (inputs.length > 0) {
       const lastInput = inputs[inputs.length - 1];
       lastInput.value = '\\n' + lastInput.value;
   }
}

function generateCommand() {
    const profession = document.getElementById('profession').value;
    const level = document.getElementById('level').value;

    let trades = [];
    
    const tradesElements = document.querySelectorAll('.trade');
    
    tradesElements.forEach(trade => {
        const sellItem = trade.querySelector('.sellItem').value || 'minecraft:stone'; // Значение по умолчанию
        const sellCount = trade.querySelector('.sellCount').value;

        const buyItem1 = trade.querySelector('.buyItem1').value || 'minecraft:stone'; // Значение по умолчанию
        const buyCount1 = trade.querySelector('.buyCount1').value;

        const buyItem2 = trade.querySelector('.buyItem2').value; // Не используем значение по умолчанию
        const buyCount2 = trade.querySelector('.buyCount2').value;

        if (sellItem && buyItem1) { // Проверяем, что обязательные поля заполнены
            let recipe = `{buy:{id:"${buyItem1}",Count:${buyCount1}},sell:{id:"${sellItem}",Count:${sellCount}}}`;
            
            if (buyItem2) { // Если второй предмет указан, добавляем его в сделку
                recipe += `},{buy:{id:"${buyItem2}",Count:${buyCount2}},sell:{id:"${sellItem}",Count:${sellCount}}}`;
            }

            trades.push(recipe);
        }
    });

    let command = `/summon minecraft:villager ~ ~ ~ {VillagerData:{type:plains,profession:"${profession}",level:${level}},Offers:{Recipes:[${trades.join(',')}]} }}`;

    document.getElementById('output').textContent = command; // Отображаем сгенерированную команду
}


   let command = `/tellraw ${target} {"text":"","color":"white","extra":[`;

   const inputs = document.querySelectorAll('.text-input');

   inputs.forEach((input, index) => {
       const text = input.querySelector('.userText').value;
       const color =
           input.querySelector('.colorPicker') ?
               input.querySelector('.colorPicker').value.slice(1) :
               'ffffff';

       if (text) {
           command += `{"text":"${text}","color":"#${color}"}`;
           const link =
               input.querySelector('.optionalLink').value;
           if (link) {
               command += `,"clickEvent":{"action":"open_url","value":"${link}"}}`;
           } else {
               command += `}`;
           }
           if (index !== inputs.length - 1) {
               command += ',';
           }
       }
   });

   command += ']}';

   document.getElementById('output').textContent =
       command.trim();
}
</script>

</body>
</html>
